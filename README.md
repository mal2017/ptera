# Pipeline for Transposon Expression Reanalysis (PTERA)

## Dependencies

Using mamba 0.9.2 (or conda 4.8.4) install the following:

```bash
mamba create -n ptera_v1 \
	python=3.9.6 snakemake=6.7.0 peppy=0.31.1 sra-tools=2.11.0 tabix=1.11 r-base=4.0.3 \
	r-tidyverse=1.3.1 r-tidymodels=0.1.3
```

Singularity must also be installed and accessible in this environment. Depending on
your system this can be done via conda. For HPCs admin privileges may be required.

Other dependencies are handled at runtime by singularity

## Where the data comes from

Accessions are included in the pepfile for this repo. This was
generated by downloading all metadata for [PRJNA483441](https://www.ncbi.nlm.nih.gov/Traces/study/?acc=PRJNA483441&o=acc_s%3Aa#)
and processing the metadata file with a custom R script (see workflow/scripts).

## Prerequisite data resources

This pipeline requires a `resources` folder which should be downloaded and placed in the
pipeline directory (level with `config/` for example).

## Running the pipeline

```bash
snakemake --profile <your profile> --use-singularity -j 999 -kp \
	--config RUN_TYPE=FULL -n
```

If disk space is at a premium, consider running with `--prioritize salmon_quant_se_vanilla `
to enforce creation of the quant output and deletion of temp files for each sample as fast as possible.

Additionally, batching may be used by specifying `--batch vanilla_salmon_terminus_collapse=1/N`
where `N` is the total number of batches the collecting rule is divided into.
This can then be repeated (`2/N` and so on) until all batches are run.
